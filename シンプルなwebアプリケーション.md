# HTMLの記述
## HTML説明
HTMLファイルはテキストファイルであり、タグ([<]と[>]で)により、文章の構造を定義します。
HTMLファイルは以下のような構成にする必要があります。

ヘッダ要素にはこのHTMLファイルに関する情報を記述し、ボディ要素には画面の構成に関する情報を記述します。

## ヘッダ要素
head要素以下には、以下のようなタグを記述することができます。
なお、これら以外にも様々なタグを記述することができますが、詳しくはWEBに多くのリファレンスがありますので、各自で調べるようにしてください。

## ボディ要素
ボディ要素以下に記述可能なタグに関しては、ログイン画面を例に説明します。
ログイン画面の場合、以下のようなHTMLタグで構成することが考えられます。

それぞれのタグの意味は以下の通りです。
これ以外にも様々なタグを記述することができます。詳しくはWEBに多くのリファレンスがありますので、各自で調べるようにしてください。

## ログイン画面HTMLの記述
実際に、ログイン画面のHTMLを記述してみましょう。
HTMLは以下のようになります。

```
code省略
```
***3~4行目：***

ヘッダ要素の記述。
titleタグでページタイトルを、metaタグで文字セットを明示しています。

***7~36行目：***

ボディ要素の記述。
ログイン画面の構成例に従ってタグを組み合わせています。
上記のファイルを適当な場所にダウンローダし、ブラウザで表示を確認してください。ブラウザには以下のように表示されます。


# CSSの記述
HTMLを書いただけの場合、各タグの表示スタイル（文字色、背景色、サイズなど）はブラウザのデフォルト定義によって決定されます。
この表示スタイルを変更したい場合は、CSSを記述する必要があります。

CSSはテキストファイルで、以下のような形式で記述します。

```
スタイルを定義したい要素 {
    プロパティ名: プロパティ値;
    ...
}
...(上記の繰り返し)
```

スタイルを定義したい要素（タグなど）を明示し、プロパティの名前と値の組を記述しています。
なお、ここでは簡単にしか説明しません。詳しくはWEBなどで調べるようにしてください。

スタイルを定義したい要素には以下のような記述をすることができます。
* 「タグ名」と書き、タグすべてに対してスタイルを指定
* 「タグ名.class名」と書き、特定のclass属性を持つタグのみに対してスタイルを指定クラス属性は、「」のようにタグに対して記述します。

また、プロパティに指定可能な値には以下のようなものがあります。

## ログイン画面CSSの記述
では、先ほどのHTMLファイルにCSSを書きくわえてみましょう。
なお、今回はCSSファイル名はtodo.cssとします。具体的には、以下のスタイルを設定することにします。

## HTMLファイルに対する変更
HTMLファイルに対する変更点は以下の通りです。

***5行目***

cssファイルへの参照を追加。
CSSファイルへの参照はlinkタグにより記述します。

各要素にclass属性を追加。
このclass 属性に対応するようにCSSファイルを記述します。
ここでは、th,tdタグなどに無条件にスタイルを設定するのではなく、画面ごとにclass属性を用いる設定することを想定しています。

## CSSファイルの記述
CSSファイルは以下のように記述します。
上記のファイルを適当な場所にダウンロードし、ブラウザで表示を確認してください。ブラウザには以下のように表示されます。


# JavaScriptの記述
ユーザの入力内容によって動的にボタンの無効/有効を切り替えたい場合があります。
このような処理はJavaScriptを記述することで実現できます。

ここでは、以下のように「ユーザID」と「パスワード」の両方に字列が入力されないと「ログイン」ボタンを無効にするようなロジックを追加してみましょう。
JavaScriptのファイル名はlogin.jsとします。

JavaScriptの記述は、部分的にはJavaによく似てはいますが、Javaとは別の言語です。

記述方法について、詳しくはWEBで調べるようにしてください。
っここではサンプルの実装に必要な最低限の項目について説明します。

## ログイン画面のJavaScript実装
では、先ほどのHTMLファイルにJavaScriptを書き加えれ見ましょう。

## HTMLファイルに対する変更
HTMLに対する重要な変更点は以下の通りです。
```
<script type="text/javascript" src="login.js">
</script>
```
JavaScriptファイルへの参照を追加。
JavaScriptファイルへの参照はscriptタグにより記述します。

***9行目***

bodyタグにonloadハンドラを追加。
読み込み完了時にfieldChanged関数を呼び出し、ボタンを無効化するようにします。

***20~23行目***

inputタグに変更時ハンドラとIDを追加。

***31~34行目***

inputタグに変更時ハンドラとIDを追加。

# JavaScriptファイルの記述
JavaScriptファイルは以下のように記述します。
フィールド変更時の処理を行うためのfieldChanged関数、およびその関数から呼び出されるgetField関数を定義しています。

ブラウザには以下のように表示されます。
「ユーザ」IDと「パスワード」に文字を入力すると、「ログイン」ボタンが有効になります。

# 一覧画面の記述
ログイン画面と同じ要領で、一覧画面を記述してみましょう。
なお、ここでは作業項目は一つとして作成していき、Servletの実装時にデータべースの内容を反映するものとします。

上記のファイルを適当な場所にダウンロードし、ブラウザで表示を確認してください。ブラウザには以下のように表示されます。ブラウザには以下のように表示されます。

# Javaプログラムの作成
Javaプログラムからデータベースに対してアクセスするためには、JDBCを利用します。
JDBCとは、Javaからデータベースに対してアクセスするための標準APIです。
パッケージjava.sqlにインタフェースおよび抽象クラスが用意してあり、データベース付属のライブラリからその実装が提供されます。

## JDBCコードの基本
JDBCは基本的に以下のように処理を記述します。

データベース付属のJDBCドライバを初期化し、java.sql.Connectionオブジェクトを取得します。
ここで指定するパラメータは接続対象のデータベースにより異なります。
H2 Databaseの場合は以下のようになります。

java.sql.ConnectionオブジェクトからStatementオブジェクトを取得し、SQL文を実行します。

一般的にはデータを取得する場合はexecuteQueryメソッドを、データを操作する場合はexecuteUpdateメソッドを呼び出します。

データベースの操作が完了したら、各オブジェクトのcloseメソッドを呼び出し、処理を完了します。

## Javaプロジェクトの作成
では実際にデータベース操作アプリケーションのコードを記述し、デバッグ·動作確認してみましょう。
ここでは以下のような動作をするアプリケーションを作成します。
* アプリケーション種別：コンソールアプリケーション
* データの取得·追加·更新·削除機能を実装します。
* 操作の種類、パラメータはコマンドライン引数として与える。

コマンドライン引数の意味は以下の通り。(実験用コードのため、引数のエラーチェックなどはしない。)

1. まずEclipseワークスペース内にプロジェクトを作成します。プロジェクトは、Eclipse上でのアプリケーションの単位です。Eclipsの「Package Exporer」上で右クリックし、「New]-「Projet...」を選択します。

2. 以下のようなダイアログが表示されるので、[Java]-[Java Project]を選択します。

3. 以下のようなダイアログが表示されるので、[Project name]に[userdb]と入力し、[Next]を押します。

4. [Libraries]タブを選択し、[Add External JARs]を押します。
5. ファイルダイアログでディレクトリ内「」を選択し、「finish」ボタンを押します。この作業により、H2　Database二アクセスするためのクラス群をuserdbプロジェクトから呼び出せるようになります。

## Javaクラスの作成
データベースにアクセスするプログラムをtest.Userクラスとして作成してみましょう。
1. testパッケージにUserDBクラスを作成します。
2. UserDB.javaとして以下のようなコードを作成します。コードのうち、重要な部分をいくつか抜粋すると以下のようになります。コンソールアプリケーションとして実行するため、main関数を定義。

JDBD接続を初期化するコードを定義。

テーブルの内容を取得するコードを定義。

テーブルにデータを追加するコードを定義。

## ここまでのファイル
ここまででプロジェクトディレクトリの内容は以下のようになります。正しく作成できているか、確認してください。

## デバッグ·動作確認
では、UserDB.javaをデバッグしましょう。
1. [Package Explorer]の[UserDB.java]アイコン上で右クリックし、[Debug As] - [Java Application]を選択します。

まだコマンドラインオプションを指定していないので、以下のようなエラーが出力されるはずです。

異なるエラーメッセージが出力された場合は、ソースコード（特にUserDB.create())が間違っていないか、H2 Dateabase が起動しているかどうかを確認してください。

2. 次に、コマンドラインオプションを指定します。[Package Explorer]の[UserDB.java]アイコン上で右クリックし、[Debug As]-[Debug Configurations...]を選択します。

3. 以下のようなダイアログボックスが表示されますので、[Arguments]タブを選択し、[Program Arguments]に[select]と入力してください。
4. [Apply]ボタンを押し入力内容を保存した後、[Close]ボタンを押しダイアログを閉じます。
5. コードの動作確認のために、ブレークポイントを設定しましょう。コードを停止したい行の左端を左ダブルクリックすると、以下のようにブレークポイントを示す印が表示されます。
6. では、改めてUserDB.javaをデバッグしましょう。
[Package Explorer]の[UserDB.java]アイコン上で右クリックし、[Debug As-[Java Applicatio]を選択します。
7. 以下のようなデバッグ画面が表示されますので、各機能を利用して順次実行します。変数ビューでの変数確認も行うようにしてください。
各機能の役割は以下の通りです。
以下のような出力が行われればデバッグ成功です。同じ要領で、insert、update、deleteも動作確認をしてください。

# 演習：作業テーブルの作成
ユーザ情報テーブルと同じ要領で、作業を格納するテーブルを記述し、データを操作するようなコンソールアプリケーションを作成してみましょう。
データ構造は以下のようにするものとします。
なお、ここまで使用したSQL文以外の知識が必要となります。WEBなどで調べながら作業してください。以下が模範解答です。コンソールアプリケーションの仕様は以下のようにしてください。

（修正されたファイルは個別にダウンロード）
（プロジェクト全体をまとめてダウンロード）

## ログイン画面の作成
まず、ログイン画面の実装を通じて、Servletの基本要素を学習していきましょう。

***プロジェクトの作成***

まず、Tomcatプロジェクトを作成します。Tomcatプロジェクトを作成することで、コンテキストバ以下のファイル構造を作成し、容易にTomcatに配備することができます。コンテキストパス以下のファイル構造は以下のようにする必要があります。

WEB-INFディレクトリはWEBアプリケーションの構成情報やクラスファイルなどを格納するために利用されます。WEB-INFディレクトリ以ファイルは直接ブラウザから参照することはできません。WEB-INFディレクトリ以外のファイルは、CSSファイル、JSファイルなど、ブラウザから参照する必要がある場合に配置します。ここに配置されたファイルは、http://(サーバ名):(ポート番号)/(コンテキストパス)(コンテキストパス内でのパス
)の形で参照することができます。ログイン画面は、以下のようなファイル構造とします。

では、Tomcatプロジェクトを作成し、ログイン画面を実装していきましょう。
Eclipseの[Package Explorer]上で右クリックし、[New]-[Project...]を選択します。[Java]-[Tomcatプロジェクト]を選択します。

[Project name]に[todotest]と入力し、[Finish]を押します。

以下のようなプロジェクトがPackage Explorer上に現れれば成功です。

***Servletクラスの作成***

Servletクラスを作成していきましょう。
Servletクラスはjavax.servlet.http.HttpServletクラスを継承する必要があり、目的に応じて以下のメソッドをオーバーライドします。（ほかにもいくつかのメソッドがあります。）

Servletのメソッドの処理の中で、リクエストに関する情報を取得したい場合にはjavax.servlet.http.HttpServletRequestオブジェクトを使用します。ここではサンプルに使用するメソッドのみ説明します。

Servletのメソッドの処理の中で、レスポンスに関する情報を設定したい場合にはHttpServletResponseオブジェクトを使用します。ここでは、JSPファイルによってレスポンスの内容を生成しますので、Servletの処理内では特に操作しません。Servletクラスを作成します。[WEB-INF/src]上で右クリックし、[New..]-[Class]を選択します。以下のダイアログが表示されたら、[Package][Name][Superclass]のフィールドに、以下のように値を設定します。TodoServletクラスを作成します。ここでは、GETリクエストに対する処理として、以下のような処理を記述します。

***パラメータの解析処理***

getParameter("action")によりactionパラメータに指定された値を取得し、loginが指定された場合に転送先としてWEB-INF/jsp/login.jspを指定しています。(実際の転送処理は後述)

また、actionパラメータが指定されていない場合や、認識できないactionパラメータが指定された場合、ServletException例外をスローしてエラー終了しています。（この場合、Tomcatのエラー画面が表示されてしまいます。次のセクションで自分が作成したエラー画面へと差し替えます。

***JSPファイルへの転送処理***

先の処理で転送先として指定さてたJSPファイルへと転送を行います。

***JSPファイルの作成***

次に、JSPファイルを作成していきましょう。先に作成したlogin.js.htmlをベースとし、JSPファイルとして処理するために必要ないくつかの記述を追加していきます。

todotestプロジェクト/WEB-INFディレクトリ以下にjspディレクトリを作成します。

***JSPファイルを作成します***

先に作ったindex.js.htmlをlogin.jspにリネームし、WEB-INF/jspディレクトリにコピーします。先に作ったCSS,JavaScriptファイルをstruts2todoプロジェクト直下にコピーします。JSPファイルに以下の修正を加えます。

JSPファイルの１行目にJSPファイルに関する属性情報を追加。

フォームの送信先がServletになるように変更。また、送信メソッドとactionパラメータを設定します。

## 設定ファイルの作成
最後に、WEB-INFフォルダ以下にweb.xmlファイルを作成します。

***7~13行目***

Servletクラスの情報を定義します。

***15~22行目***

Servletクラスのパスを定義します。servlet要素の定義とはservlet-name要素の値を通じて関連付けられます。

***ここまでのファイル***

ここまででプロジェクトディレクトリの内容は以下のようになります。正しく作成で来ているか、確認してください。

***デバッグ·動作確認***

[Tomcat起動]ボタンを押します。ます、何もクエリを指定せず、意図的にエラーを起こしてみましょう。Servletは何もクエリを指定しなければ、action名が取得できず、エラーが発生するはずです。ブラウザで以下ンURLを開きます。
http://localhost:8080/todotest/todo
以下のエラー画面が現れればただしくServletは動作しています。

次に、デバッガの使用方法の確認もかねて、パラメータを指定して実行してみましょう。コンソールアプリケーションと同じ要領で、TodoServlet.javaおdoGetの初めにブレークポイントを設定します。ブラウザで以下のURLを開きます。
http://localhost:8080/todotest/todo?action=login
以下のようにEclipseのデバッガが起動します。（以下の画面構成にならない場合は、Eclipseメニューの[Window]-[Open Perspective]-[Debug]を実行してください。

デバッグ実行完了後、ブラウザに以下の画面が現れれば成功です。

## 一覧画面とエラー画面の作成
次に、一覧画面とエラー画面を実装します。修正内容は以下の通りです。

## H2 Database ライブラリのクラスパスへの追加
WEBアプリケーションからJARファイル中のクラスを参照するためには、JARファイルをWEB-INF/lib以下に配置する必要があります。H2 DatabaseライブラリをWEBアプリケーションから参照できるようにしましょう。ログイン処理及び一覧画面はデータベースアクセスを必要とするため、まず、WEB-INF/libにH2 DatabaseのJARをコピーします。C:￥Program Files\H2\bin\h2-10jarを、(todotestプロジェクト)/WEB-INF/libにコーピします。次に、todotestプロジェクトのクラスパスにH2 DatabaseのJARを登録します。todotestプロジェクト上で右クリックし、[Properties]を選択します。ダイアログが表示されたら、[Java Build Path]の[Libraries]タブを選択します。

Add JARS...ボタンを押し、（todotestプロジェクト）/WEB-INF/lib/h2-10jarを選択します。これでWEBアプリケーションからH2 Databaseのクラスを参照できるようになります。